<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Carros</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
</head>
<body>

    <label for="categoria">Selecione a Categoria:</label>
    <select id="categoria">
        <option value="SUV">SUV</option>
        <option value="PREMIUM">PREMIUM</option>
        <option value="HATCH/SEDAN">HATCH/SEDAN</option>
        <option value="REPASSE">REPASSE</option>
    </select>

    <br>

    <label for="loja">Selecione a Loja:</label>
    <select id="loja"></select>

    <br>

    <button onclick="consultar()">Consultar</button>

    <script>
        async function preencherLojas() {
            var url = "https://raw.githubusercontent.com/Lucashs98/quadro/0f5dd273800c5f69e01505dfbbf830902ce1d718/regra.xlsx";

            try {
                const response = await fetch(url);
                const data = await response.arrayBuffer();
                const arr = new Array();
                for (let i = 0; i < data.byteLength; i++) {
                    arr.push(String.fromCharCode(data[i]));
                }
                const bstr = arr.join("");

                const workbook = XLSX.read(bstr, { type: "binary" });

                const lojas = obterLojas(workbook);

                preencherOpcoesLojas(lojas);
            } catch (error) {
                console.error("Erro ao carregar a planilha:", error);
            }
        }

        function obterLojas(workbook) {
            const lojas = [];
            
            const sheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[sheetName];

            // Supondo que as lojas estão na coluna A (começando da linha 2)
            const range = XLSX.utils.decode_range(sheet["!ref"]);
            for (let row = range.s.r + 1; row <= range.e.r; row++) {
                const cellAddress = { c: 0, r: row };
                const cellRef = XLSX.utils.encode_cell(cellAddress);
                const loja = sheet[cellRef].v.trim();  // Remova espaços extras

                if (loja !== "") {
                    // Adiciona a loja à lista se não estiver vazia
                    lojas.push(loja);
                }
            }

            return lojas;
        }

        function preencherOpcoesLojas(lojas) {
            const selectLoja = document.getElementById("loja");

            // Limpa as opções existentes
            selectLoja.innerHTML = "";

            // Adiciona as novas opções
            lojas.forEach(loja => {
                const option = document.createElement("option");
                option.value = loja;
                option.text = loja;
                selectLoja.add(option);
            });
        }

        function consultar() {
            const categoria = document.getElementById("categoria").value;
            const loja = document.getElementById("loja").value;

            // Aqui você deve adicionar lógica para procurar na planilha e exibir o resultado
            console.log("Categoria:", categoria);
            console.log("Loja:", loja);
        }

        window.onload = function () {
            preencherLojas();
        };
    </script>

</body>
</html>
